"use strict";var woostifyPrevSiblings=function(e){var t=[],o=e;if(o&&o.previousElementSibling)for(;o=o.previousElementSibling;)t.push(o);return t},woostifyNextSiblings=function(e){var t=[],o=e;if(o&&o.nextElementSibling)for(;o=o.nextElementSibling;)t.push(o);return t},woostifySiblings=function(e){var t=woostifyPrevSiblings(e)||[],o=woostifyNextSiblings(e)||[];return t.concat(o)},woostifyButtonShowPopup=function(){var e=document.querySelectorAll(".menu-item-mega_menu.menu-item-depth-0");e.length&&e.forEach((function(e){var t=e.getAttribute("id"),o=e.querySelector(".edit-menu-item-title"),n=!!o&&o.closest("p.description");n&&t&&(t=t.replace("menu-item-",""),n.insertAdjacentHTML("afterend",'<div class="description description-wide"><span class="woostify-mega-menu-options-button button" data-id="'+t+'" data-depth="0">'+woostify_admin_mega_menu.button_label+"</span></div>"))}))},woostifyIconPicker=function(){var e=document.querySelector(".woostify-icon-picker");if(e){e.querySelector(".woostify-icon-picker-inner");var t=e.querySelectorAll("span"),o=e.querySelector(".woostify-icon-picker-value");t.length&&t.forEach((function(e){e.onclick=function(){var t=woostifySiblings(e),n=e.getAttribute("data-icon");e.classList.contains("selected")?(e.classList.remove("selected"),o.value=""):(e.classList.add("selected"),o.value=n),t&&t.forEach((function(e){e.classList.remove("selected")}))}}))}},woostifySaveMenuOptions=function(){var e=document.querySelector(".woostify-mega-menu-options-popup"),t=e.getAttribute("data-id"),o=document.querySelector("#menu-item-"+t+" .woostify-mega-menu-options-button").getAttribute("data-id");e.querySelector(".save-options").onclick=function(){var t=this,n=e.querySelectorAll("[name*=woostify_mega_menu_item_]"),i={};t.classList.add("loading"),t.setAttribute("disabled","disabled"),n.length&&n.forEach((function(e){i[e.name]=e.value.replace(/&/g,encodeURIComponent("&"))}));var s=new Request(ajaxurl,{method:"POST",body:"action=woostify_save_menu_options&security_nonce="+woostify_admin_mega_menu.ajax_nonce+"&menu_item_id="+o+"&options="+JSON.stringify(i),credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(s).then((function(e){200===e.status||console.log("Status Code: "+e.status)})).catch((function(e){console.log(e)})).finally((function(){t.classList.remove("loading"),t.removeAttribute("disabled")}))}},woostifyEditMegaMenu=function(){var e=document.querySelectorAll(".woostify-mega-menu-options-button");e.length&&e.forEach((function(e){var t=document.querySelector(".woostify-mega-menu-options-popup"),o=t.querySelector(".woostify-mega-menu-popup-inner"),n=t.querySelector(".woostify-mega-menu-popup-content"),i=t.querySelector(".woostify-mega-menu-editing-label"),s=t.querySelector(".woostify-mega-menu-popup-button-close"),a=e.getAttribute("data-id"),u=e.getAttribute("data-depth"),c=function(){document.documentElement.classList.remove("has-mega-menu-open")};e.onclick=function(){if(!(u>0)){document.documentElement.classList.add("has-mega-menu-open");var e=document.getElementById("menu-item-"+a),r=t.getAttribute("data-id"),l=e?e.querySelector(".menu-item-title").innerHTML:"",d=e?e.querySelector(".item-type").innerHTML:"";if(r!==a){i.innerHTML=i.getAttribute("data-label")+" "+d+": "+l,n.innerHTML="",o.classList.add("loading");var m=new Request(ajaxurl,{method:"POST",body:"action=woostify_render_popup&security_nonce="+woostify_admin_mega_menu.ajax_nonce+"&menu_item_id="+a+"&depth="+u,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(m).then((function(e){200===e.status?e.json().then((function(e){e.success&&(n.innerHTML=e.data,woostifyIconPicker())})):console.log("Status Code: "+e.status)})).catch((function(e){console.log(e)})).finally((function(){t.setAttribute("data-id",a),o.classList.remove("loading"),woostifySaveMenuOptions(),t.onclick=function(e){e.target.closest(".woostify-mega-menu-popup-inner")||c()},s.onclick=function(){c()},document.body.addEventListener("keyup",(function(e){27===e.keyCode&&c()}))}))}}}}))};document.addEventListener("DOMContentLoaded",(function(){woostifyButtonShowPopup(),woostifyEditMegaMenu()}));