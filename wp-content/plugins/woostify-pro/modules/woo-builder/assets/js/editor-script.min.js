"use strict";var woostifySearchDelay=function(e){return void 0===e&&(e=0),function(o,t){clearTimeout(e),e=setTimeout(o,t)}}(),woostifySelectProductPreview=function(e){NProgress.start();var o={action:"woo_builder_select_product_preview",ajax_nonce:woostify_woo_builder_editor.ajax_nonce,post_id:woostify_woo_builder_editor.post_id,selected_id:e};o=new URLSearchParams(o).toString();var t=new Request(woostify_woo_builder_editor.ajax_url,{method:"POST",body:o,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(t).then((function(e){if(200!==e.status)throw console.log("Status Code: "+e.status),e;return e.json()})).then((function(e){e.success})).catch((function(e){console.log(e)})).finally((function(){"undefined"!=typeof elementor&&elementor.reloadPreview(),NProgress.done()}))},woostifyWooBuilderPreview=function(){var e=document.getElementById("elementor-panel-footer-tools");if(e){window.wooBuilderOpen=null;var o=e.querySelector("#elementor-panel-footer-saver-preview");if(o&&woostify_woo_builder_editor.is_product_template){o.setAttribute("id","woostify-tool-preview-button");var t=e.querySelector("#elementor-panel-footer-saver-preview-label");if(t){var i="";i+='<div class="woostify-preview-settings-wrap">',i+='<div class="woostify-preview-settings-inner">',i+='<div class="woostify-preview-search">',i+='<div class="woostify-preview-search-result"></div>',i+='<input class="woostify-preview-search-field" placeholder="'+woostify_woo_builder_editor.search_placeholder+'">',i+="</div>",i+='<span class="woostify-preview-value" data-url>'+woostify_woo_builder_editor.select_preview+"</span>",i+='<span class="woostify-preview-button">'+woostify_woo_builder_editor.preview_text+"</span>",i+="</div>",i+="</div>",t.insertAdjacentHTML("afterend",i);var n=0,r=0;t.onclick=function(o){o.preventDefault(),0==r?(r=1,document.body.classList.add("hide-elementor-tooltip"),t.parentNode.classList.add("elementor-open")):(r=0,document.body.classList.remove("hide-elementor-tooltip"),t.parentNode.classList.remove("elementor-open"));var i=e.querySelector(".woostify-preview-settings-wrap"),s=i.querySelector(".woostify-preview-value"),a=i.querySelector(".woostify-preview-search"),c=i.querySelector(".woostify-preview-search-field"),l=i.querySelector(".woostify-preview-search-result"),d=i.querySelector(".woostify-preview-button");s&&(s.onclick=function(){a&&(0==n?(n=1,a.classList.add("active")):(n=0,a.classList.remove("active"))),c&&(c.focus(),c.oninput=function(){var e=c.value.trim();e&&l?woostifySearchDelay((function(){l&&(l.innerHTML='<span class="result-item">'+woostify_woo_builder_editor.searching_text+"</span>");var o={action:"woo_builder_preview_search_data",ajax_nonce:woostify_woo_builder_editor.ajax_nonce,post_id:woostify_woo_builder_editor.post_id,keyword:e};o=new URLSearchParams(o).toString();var t=new Request(woostify_woo_builder_editor.ajax_url,{method:"POST",body:o,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(t).then((function(e){if(200!==e.status)throw console.log("Status Code: "+e.status),e;return e.json()})).then((function(e){e.success&&l&&(l.innerHTML=e.data.content)})).catch((function(e){console.log(e)})).finally((function(){var e=l?l.querySelectorAll(".result-item"):[];e.length&&e.forEach((function(e){e.onclick=function(){var o=e.getAttribute("data-url");if(o&&s){s.innerHTML=e.innerHTML,s.setAttribute("data-url",o);var t=e.getAttribute("data-id");t&&woostifySelectProductPreview(t),s.click()}}}))}))}),500):l.innerHTML=""})}),d&&(d.onclick=function(){var e=s?s.getAttribute("data-url"):"";e=e||woostify_woo_builder_editor.preview_url,window.wooBuilderOpen&&window.wooBuilderOpen.parent&&e===window.wooBuilderOpen.location.href?window.wooBuilderOpen.focus():window.wooBuilderOpen=window.open(e,"_blank")})}}}var s=e.querySelector("#elementor-panel-footer-sub-menu-item-save-template");if(s){s.insertAdjacentHTML("beforebegin",'<div id="woostify-tool-display-conditions" class="elementor-panel-footer-sub-menu-item"><i class="elementor-icon eicon-flow" aria-hidden="true"></i><div class="elementor-title">'+woostify_woo_builder_editor.condition_text+"</div></div>");var a=document.getElementById("elementor-preview"),c=e.querySelector("#woostify-tool-display-conditions"),l=document.getElementById("woostify-woobuilder-conditions-html");a&&l&&a.insertAdjacentHTML("afterend",l.innerHTML);var d=document.querySelector(".woostify-woobuilder-conditions");c&&d&&(c.onclick=function(e){e.preventDefault(),d.classList.add("active");var o=function(){d.classList.remove("active")};d.onclick=function(e){this===e.target&&o()};var t=d.querySelector(".woostify-woobuilder-conditions-close-btn");t&&(t.onclick=o),document.body.addEventListener("keyup",(function(e){27===e.keyCode&&o()}));var i=d.querySelector(".woostify-woobuilder-conditions-content-inner"),n=!!i&&i.querySelector(".woostify-woobuilder-condition-item-wrapper"),r=!!i&&i.querySelector(".woostify-condition-add-button"),s=function(){var e=document.querySelectorAll(".woostify-woobuilder-conditions .woostify-condition-item-remove");e.length&&e.forEach((function(e){e.onclick=function(){var o=e.parentNode;(o.nextElementSibling||o.previousElementSibling)&&o.remove()}}))};if(s(),r){var a=r.getAttribute("data-type")||"";r.onclick=function(){var e=document.getElementById("woostify-woobuilder-conditions-"+a+"-html");e&&n&&n.insertAdjacentHTML("beforeend",e.innerHTML),s(),f()}}})}var u=document.getElementById("elementor-panel-saver-button-publish");if(u&&"publish"!=woostify_woo_builder_editor.post_status){u.insertAdjacentHTML("beforebegin",'<button id="woostify-panel-saver-button-publish" class="elementor-button elementor-button-success">'+u.innerHTML+"</button>");var w=document.getElementById("woostify-panel-saver-button-publish");if(!w)return;w.onclick=function(e){if(!this.classList.contains("elementor-disabled")){var o=document.getElementById("woostify-tool-display-conditions");o&&o.click()}}}var f=function(){if(d){var e=d.querySelectorAll(".woostify-condition-item");e.length&&e.forEach((function(e){var o=e.querySelector(".woostify-condition-item-field"),t=e.querySelector(".woostify-condition-item-search-view");o&&(o.onchange=function(){["in-cat","in-tag"].includes(o.value)?e.classList.add("has-search-field"):(e.classList.remove("has-search-field"),t&&(t.setAttribute("data-id","all"),t.innerHTML=woostify_woo_builder_editor.all_text))});var i=e.querySelector(".woostify-condition-item-search");if(i){var n=i.querySelector(".woostify-condition-item-search-field"),r=0;i.onclick=function(e){var o=this,t=o.closest(".woostify-woobuilder-condition-item-wrapper"),s=t?t.querySelectorAll(".woostify-condition-item-search.active"):[];e.target!==n&&(s.length&&s.forEach((function(e){e!==o&&e.classList.remove("active")})),0==r?(o.classList.add("active"),r=1,n&&n.focus()):(r=0,o.classList.remove("active")),document.onclick=function(e){var t=e.target;t!==o&&t!==n&&(r=0,i.classList.remove("active"))})},n&&(n.oninput=function(){var e=i.querySelector(".woostify-condition-item-search-view"),t=n.value.trim(),r=i.querySelector(".woostify-condition-item-search-result");t&&r?woostifySearchDelay((function(){r&&(r.innerHTML='<span class="result-item">'+woostify_woo_builder_editor.searching_text+"</span>");var i={action:"woo_builder_conditions_search_data",ajax_nonce:woostify_woo_builder_editor.ajax_nonce,post_id:woostify_woo_builder_editor.post_id,field_value:o.value,keyword:t};i=new URLSearchParams(i).toString();var n=new Request(woostify_woo_builder_editor.ajax_url,{method:"POST",body:i,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(n).then((function(e){if(200!==e.status)throw console.log("Status Code: "+e.status),e;return e.json()})).then((function(e){if(e.success){var o=e.data;r&&(r.innerHTML=o.content)}})).catch((function(e){console.log(e)})).finally((function(){var o=r?r.querySelectorAll(".result-item"):[];o.length&&o.forEach((function(o){o.onclick=function(){var t=o.getAttribute("data-id");t&&e&&(e.innerHTML=o.innerHTML,e.setAttribute("data-id",t))}}))}))}),500):r.innerHTML=""})}}))}};f();!function(){if(d){var e=d.querySelector(".save-options");e&&(e.onclick=function(){var e=d.querySelectorAll(".woostify-condition-item");if(e.length){NProgress.start(),d.click(),u&&u.classList.add("elementor-button-state");var o=document.getElementById("woostify-panel-saver-button-publish");o&&o.classList.add("disabled","elementor-button-state");var t=[];e.forEach((function(e,o){var i=e.querySelector(".woostify-condition-item-type"),n=e.querySelector(".woostify-condition-item-field"),r=e.querySelector(".woostify-condition-item-search-view"),s=r?r.getAttribute("data-id"):"all";i&&n&&t.push({data_type:i.value,data_field:n.value,data_id:s})}));var i={action:"save_woo_builder_conditions",ajax_nonce:woostify_woo_builder_editor.ajax_nonce,post_id:woostify_woo_builder_editor.post_id,conditions:JSON.stringify(t)};i=new URLSearchParams(i).toString();var n=new Request(woostify_woo_builder_editor.ajax_url,{method:"POST",body:i,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(n).then((function(e){if(200!==e.status)throw console.log("Status Code: "+e.status),e;return e.json()})).then((function(e){e.success})).catch((function(e){console.log(e)})).finally((function(){u&&(u.classList.remove("elementor-button-state"),u.click()),o&&o.classList.remove("elementor-button-state"),NProgress.done()}))}})}}(),elementor.saver.on("after:save",(function(e){window.wooBuilderOpen&&window.wooBuilderOpen.parent&&window.wooBuilderOpen.location.reload()}))}};window.addEventListener("load",(function(){woostifyWooBuilderPreview()}));